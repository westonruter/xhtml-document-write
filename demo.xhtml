<?xml version="1.0"?>
<!--
XHTML documment.write() Support (v1.0)
 <http://code.google.com/p/shepherd-interactive/wiki/XHTMLDocumentWrite>
 by Weston Ruter, Shepherd Interactive <http://www.shepherd-interactive.com/>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

$Id: xhtml-document-write.js 7 2008-05-15 20:15:17Z westonruter $
Copyright 2008, Shepherd Interactive. All rights reserved.
-->
<!DOCTYPE html><!-- XHTML5 -->
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>XHTML document.write() Support Demo</title>
	</head>
	<body>
		<h1>XHTML <code>document.write()</code> Support Demo</h1>
		
		
		<!-- BEGIN *********************************-->
		<script type="text/javascript" src="http://shepherd-interactive.googlecode.com/svn/trunk/xhtml-document-write/xhtml-document-write.js"></script>
		
		<style type="text/css">
		#demo-result {
			background-color:#C0FFC0;
			vertical-align:middle;
			font-weight:bold;
		}
		#demo-result.loading {
			font-style:italic;
			color:gray;
			background-color:transparent;
		}
		</style>
		
		<p>Google's AJAX APIs provide some incredible tools which equip web developers to do some amazing things. I've lately been dazzeled by the power and accuracy of their
		<a href="http://code.google.com/apis/ajaxlanguage/">AJAX Language API</a> and also of the performance and convenience afforded
		by their <a href="http://code.google.com/apis/ajaxlibs/">AJAX Libraries API</a>. The only issue I have with their APIs is that the fundamental 
		<code>google.load()</code> function uses <code>document.write()</code> to ouput the necessary <code>script</code> elements to the DOM,
		which doesn't even appear to be necessary since <code>google.setOnLoadCallback()</code> executes after the scripts are loaded without using <code>document.write()</code>
		(but instead appended document with DOM methods). And the reason why using <code>document.write()</code> is bad, of course, is that it is not available when in XHTML.</p>
		
		<p>But there is a solution! You can use the Google AJAX APIs and other libraries that use <code>document.write()</code> to include <em>external scripts and stylesheets</em>
		if you define and implement <code>document.write()</code> yourself. This is exactly what <a href="http://shepherd-interactive.googlecode.com/svn/trunk/xhtml-document-write/xhtml-document-write.js">this script</a> accomplishes,
		as the following demonstrates.</p>
	
		<hr />
		
		<p>The phrase “<strong>Hello world!</strong>” (loaded from an <a href="sourceText.js">external script</a>) is translated into Spanish via Google's <a href="http://code.google.com/apis/ajaxlanguage/">AJAX Language API</a> and
		then animated using <a href="http://jquery.com/">jQuery</a>: <span id="demo-result" class='loading'>Loading...</span></p>
	
		<p>The Language API is loaded via <code>google.load('language', 1)</code> and its completed load-state is detected by <code>google.setOnLoadCallback()</code>.
		The completed load-state of the <code>sourceText</code> variable is then detected with this anonymous polling function:
		</p>

<pre><code>(function(){
    if(window.sourceText){
        //ready to work!
    }
    else
        setTimeout(arguments.callee, 10);
})();</code></pre>
	
		<p>This document may be served as either <code>application/xhtml+xml</code> or <code>text/html</code> (i.e. for IE).</p>
		
		<script type="text/javascript" src="http://www.google.com/jsapi"></script>
		<script type="text/javascript">
		//<![CDATA[
		google.load('language', 1);
		if(!window.jQuery)
			google.load('jquery', 1);
		google.setOnLoadCallback(function() {
			google.language.translate("Hello world!", "", "es", function(result){
				//This anonymous polling function can be used to check every 10ms whether the sourceText variable has been loaded
				(function(){
					if(window.sourceText){
						var span = document.getElementById('demo-result');
						span.removeChild(span.firstChild);
						span.appendChild(document.createTextNode(result.translation));
						span.className = "";
						
						$("#demo-result").animate({
							//fontSize: "2em",
							paddingLeft:"20px",
							paddingRight:"20px"
						});
					}
					else //recursibe call to check again
						setTimeout(arguments.callee, 10);
				})();
			});
		});
		//]]>
		</script>
		
		
		<script type="text/javascript">
		//<![CDATA[
		//The sourceText variable is loaded by loading the following script. This demonstrates how to detect when a script has been
		//  asyncronously loaded if the library does not support something like google.setOnLoadCallback()
		document.write("\u003Cscript type='text/javascript' src='sourceText.js'\u003E\u003C/"+"script\u003E");
		//]]>
		</script>
	
		<!-- END *********************************-->
	
		<hr />
		<address>
			<a href="http://weston.ruter.net/">Weston Ruter</a>, <a href="http://www.shepherd-interactive.com/">Shepherd Interactive</a><br />
			May 2008
		</address>
	</body>
</html>